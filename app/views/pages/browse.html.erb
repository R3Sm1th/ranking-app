<div class="col-12 col-6-lg">
  <div class="container text-center">
    <form class="row g-2 justify-content-center py-5" id="search-form">
      <div style="width:80%">
        <input type="text" class="form-control" placeholder="Find a movie (by title)" id="search-input">
      </div>
      <div style="width:20%">
        <input type="submit" class="btn btn-primary">
      </div>
    </form>
    <div id="results" class="cards">
      <%# inserted into here... %>
    </div>
  </div>
</div>

<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Movie Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <img src="" alt="">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<script>
// window.onload = function() {
//   console.log("path name:");
//   console.log(window.location.pathname);
//   if (window.location.pathname == '/browse') {
    console.log("connected to browse")
    // if (list !== undefined) {
    //   list = null
    //   form = null
    // }


    const list = document.querySelector("#results")

    const detailedView = (data) => {
      const details =
      `<div class="inner-modal">
        <h1>${data.Title}</h1>
        <img src='${data.Poster}'></img>
        <div class="infos">
          <p><strong>Release Date:</strong> ${data.Released}</p>
          <p><strong>Runtime:</strong>  ${data.Runtime}</p>
          <p><strong>Rating:</strong>  ${data.Rated}</p>
          <p><strong>Genre:</strong>  ${data.Genre}</p>
        </div>
        <div class="actors">
          <p><strong>Director:</strong>${data.Director}</p>
          <p><strong>Writer:</strong>${data.Writer}</p>
          <p><strong>Actors:</strong>${data.Actors}</p>
        </div>
        <div class="plot">
          <p>Plot</p>
          <p>${data.Plot}</p>
        </div>
        <div class="infos">
          <p><strong>Awards: </strong>${data.Awards}</p>
        </div>
        <div class="score">
          <div>
            <img src="https://res.cloudinary.com/dcu7y5wnn/image/upload/v1689929621/Metacritic_spyctc.png"></img>
            <p>${data.Metascore}</p>
          </div>
          <div>
            <img src="https://res.cloudinary.com/dcu7y5wnn/image/upload/v1689929978/613f661716381700041030fc_l9k9hz.png"></img>
            <p>${data.imdbRating}</p>
          </div>
        </div>
        <div class="actors">
          <p><strong>Website: </strong>${data.Website}</p>
        </div>
      </div>`;
      return details
    };

    const fetchMovieData = async (query) => {
      const response = await fetch(`https://www.omdbapi.com/?apikey=adf1f2d7&i=${query}`);
      const data = await response.json();
      return data;
    };
    const insertMovies = (data) => {
      data.Search.forEach((result) => {
        const movieTag = `<div class="card">
          <img src="${result.Poster}" alt="">
          <div class="content">
            <h6> ${result.Title} </h6>
            <p> Release Year: ${result.Year} </p>
            <button type="button" class="btn btn-primary modal-btn" data-bs-toggle="modal" data-bs-target="#exampleModal" data-imdbid="${result.imdbID}">
              More Info
            </button>
          </div>
        </div>`;
        list.insertAdjacentHTML("beforeend", movieTag);
      });

      list.addEventListener("click", async (event) => {
        const target = event.target;
        // Check if the clicked element is the "More Info" button
        if (target.classList.contains("modal-btn")) {
          const imdbID = target.getAttribute("data-imdbid");
          const modalContent = document.querySelector(".modal-body");
          const movie = await fetchMovieData(imdbID);
          modalContent.innerHTML = detailedView(movie);
        }
      });
    };

      const fetchMovies = (query) => {
        fetch(`http://www.omdbapi.com/?s=${query}&apikey=adf1f2d7`)
          .then(response => response.json())
          .then(data => insertMovies(data))
          // .then(() => setupModalButtonClickListeners());
      }

      const form = document.querySelector("#search-form")
      form.addEventListener("submit", (event) => {
        event.preventDefault()
        list.innerHTML = ""
        const input = document.querySelector("#search-input")
        fetchMovies(input.value)
      });

      fetchMovies("harry potter");//....
// }};
</script>
